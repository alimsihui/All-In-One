<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Update Role</title>

    <!-- Vue 2 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.10/dist/vue.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <!-- Nav Bar -->
    <nav class="navbar navbar-expand-lg navbar-light custombg">
		<a class="navbar-brand" href="#">Learning Journey Planning System</a>
		<div class="navbar-nav">
			<div class="nav-item active">
				<a class="nav-link" href="#">Home</a>
			</div>
			<div class="navbar-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="browseDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Browse
				</a>
				<div class="dropdown-menu" aria-labelledby="browseDropdown">
					<a class="dropdown-item" href="view_courses.html">Courses</a>
					<a class="dropdown-item" href="view_roles.html">Roles</a>
					<a class="dropdown-item" href="#">Skills</a>
				</div>
			</div>
			<div class="navbar-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					User Type
				</a>
				<div class="dropdown-menu" aria-labelledby="userDropdown">
					<a class="dropdown-item" href="#">Learner</a>
					<a class="dropdown-item" href="#">Human Resouces</a>
				</div>
			</div>
		</div>
		<div class="navbar-item ml-auto">
			<a class="nav-link" href="#">Logout</a>
		</div>
	  </nav>
    
    <!-- Page Content -->
    <div class="container mx-5 my-4" id="app">
        <form>
            
            <div v-if="editNameMode==true">
                
                <h2>{{selected_role_name}}</h2>

                <h5>New Name: </h5>
                    <div class="row">
                        <div class="col-sm">
                <input class="form-control" :placeholder="selected_role_name" v-model="changed_name">
            </div>
                <div class="col-lg"><button type="button" class="btn btn-primary" @click="toggleNameEdit()">Cancel Edit</button></div>
            </div>
            </div>
            <div v-if="editNameMode==false" class="row">
                <div class="col-sm">
                <h2>{{selected_role_name}}</h2>
                </div>
                <div class="col-lg">
                <button type="button" class="btn btn-primary" @click="toggleNameEdit()">Edit Name</button>
                </div>
            </div>
            
            <br/>
          <h3>Skills Currently Required</h3>
          <span v-for="skill in static_required_skills" :key="skill.Skill_Name">{{skill.Skill_Name}}<br></span>
          <div class="container">
            <br>
                <div class="row">
                    <div class="col-md">
                        <h4>Skills Required</h4>
                        <span v-for="skill in required_skills" @click="toggleSkill(skill)" :key="skill.Skill_Name"><br>{{skill.Skill_Name}}</span>
                        
                      </div>
                  <div class="col-md">
                    <h4>Other</h4>
                    <span v-for="skill in all_skills" @click="toggleSkill(skill)" :key="skill.Skill_Name"><br>{{skill.Skill_Name}}</span>
                  </div>
                  
                  
                </div><br>
                <div><button type="button" class="btn btn-primary" @click="save()">Save</button>&nbsp;
                <button type="button" class="btn btn-secondary" @click="cancel()">Refresh</button></div>

              </div>
     

         

        </form>
    </div>

    <script>
        var headers = {
                "Access-Control-Allow-Origin": "*",
                "Content-Type": "application/json"
            }
        var vm = new Vue({
            el: '#app',
            
            data: {
                selected_role_name:'Data Analyst',
                changed_name:'Data Analyst',
                selected_role_id:3,
                all_skills: [],
                required_skills: [],
                static_required_skills:[],
                editNameMode:false
            },
            methods: {
                toggleNameEdit(){
                    if (vm.editNameMode==false){
                        vm.editNameMode=true
                    } else {
                        vm.editNameMode=false
                        this.changed_name=''
                        console.log(this.selected_role_name)
                    }
                },
                getSkills(){
                    axios.get('http://127.0.0.1:5000/skill_set/'+this.selected_role_name)
                    .then(function (response) {
                        var res=response.data.data['Skill_Set']
                        vm.required_skills.splice(0, 0, res); 
                        vm.required_skills=vm.required_skills[0]
                        console.log(vm.required_skills,'REQUIRED SKILLS !!!!!!======')
                        vm.static_required_skills=[...vm.required_skills]
                        console.log(vm.static_required_skills,'STATIC')
                        axios.get('http://127.0.0.1:5000/skill')
                                .then(function (response3) {
                                    vm.all_skills.splice(0, 0, response3.data.data.skill); 
                                    vm.all_skills=vm.all_skills[0]
                                    for(let j = 0; j < vm.required_skills.length; j++){
                                        const i = vm.all_skills.findIndex(e => e.Skill_Name ==vm.required_skills[j].Skill_Name);
                                        if (i > -1) {
                                            vm.all_skills.splice(i,1)
                                        }
                                    }
                                    
                                    console.log(vm.all_skills,'all skill')
                                }).catch(error => {
                                    console.log(error);
                                });    
                    }).catch(error => {
                                console.log(error);
                            });
                },
                toggleSkill(skill) {
                    //console.log(skill,'skill')
                    if (vm.all_skills.includes(skill)){
                        //console.log('it is in all skill')
                        var index = this.all_skills.indexOf(skill);
                        this.all_skills.splice(index,1)
                        this.required_skills.push(skill)
                    } else {
                        //console.log('it is in requyired skill')
                        var index = this.required_skills.indexOf(skill);
                        this.required_skills.splice(index,1)
                        this.all_skills.push(skill)
                    }
                    //console.log(vm.static_required_skills,'static')
                    //console.log(vm.required_skills,'required')
                },
                cancel(){
                    this.getSkills();
                    this.selected_role_name='Data Analyst'
                },
                async save(){
                    // for item of static list
                    // if not in updated list
                    // remove
                    let to_be_deleted=[]
                    let to_be_added = []
                    for(let i = 0; i < vm.static_required_skills.length; i++){
                        if (!vm.required_skills.includes(vm.static_required_skills[i])){
                            to_be_deleted.push(vm.static_required_skills[i]['Skill_Name'])
                        }
                    }
                    console.log(to_be_deleted,'will be deleted')
                    
                    // for item in updated list
                    // if not in static list
                    // create
                    for(let i = 0; i < vm.required_skills.length; i++){
                        if (!vm.static_required_skills.includes(vm.required_skills[i])){
                            to_be_added.push(vm.required_skills[i]['Skill_Name'])
                        }
                    }
                    console.log(to_be_added,'will be added')

                    update_data={'Skills_To_Add':to_be_added,'Skills_To_Delete':to_be_deleted,'Position_Name':'Data Analyst'}
                    console.log(update_data,'UPDATE!')
                    await axios.post("http://127.0.0.1:5000/update_skillset",update_data)
                        .then(response => console.log(response,'hi'));

                    
                    // update name of role
                    update_name_data={"Current_Name":this.selected_role_name,"New_Name":this.changed_name}
                    console.log(update_name_data)
                    axios.post("http://127.0.0.1:5000/position/update",update_name_data)
                        .then(response => console.log(response,'hi'));
                    
                },
            },
            mounted: function() {
                this.getSkills();
                console.log(this.changed_name)
            }
        });

    </script>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>

</html>